<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher Dashboard</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    :root {
      --primary-color: #4BABB1; /* اللون الأساسي */
      --bg-light: #FFFFFF;     /* خلفيات العناصر */
      --bg-gray: #F5F7FA;      /* خلفية الصفحة */
      --text-primary: #2D3748; /* النصوص الأساسية */
      --text-secondary: #718096; /* النصوص الثانوية */
      --text-light: #A0AEC0;   /* نصوص خفيفة */
      --border-color: #E2E8F0; /* حدود */
      --shadow-color: rgba(0, 0, 0, 0.1); /* ظلال */
      --success-color: #4CAF50; /* لون النجاح */
      --danger-color: #f44336;  /* لون الخطر */
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    
    body {
      min-height: 100vh;
      background-color: var(--bg-gray);
      transition: all 0.4s ease;
    }
    
    /* 🔥 Sidebar Styles - معدلة لتتناسب مع الهوم */
    .sidebar {
      width: 280px;
      height: 95vh;
      position: fixed;
      top: 2.5vh;
      left: 20px;
      background: var(--bg-light);
      border-radius: 16px;
      box-shadow: 0 10px 25px var(--shadow-color);
      transition: all 0.4s ease;
      z-index: 100;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .sidebar.closed {
      transform: translateX(-100%);
      opacity: 0;
      pointer-events: none;
    }
    
    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      text-align: center;
    }
    
    .project-name {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .project-name i {
      color: var(--primary-color);
      font-size: 1.5rem;
    }
    
    .menu-items {
      flex: 1;
      padding: 16px 0;
      overflow-y: auto;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 16px 24px;
      color: var(--text-primary);
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
      margin: 8px 12px;
      border-radius: 8px;
    }
    
    .menu-item:hover {
      color: var(--primary-color);
      background: rgba(75, 171, 177, 0.08);
      transform: translateX(5px);
    }
    
    .menu-item.active {
      color: var(--primary-color);
      font-weight: 500;
      background: rgba(75, 171, 177, 0.08);
    }
    
    .menu-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: var(--primary-color);
      border-radius: 0 4px 4px 0;
    }
    
    .menu-item i {
      margin-right: 12px;
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }
    
    /* Toggle Button - معدل ليتناسب مع الهوم */
    .toggle-btn {
      position: fixed;
      top: 28px;
      left: 28px;
      width: 40px;
      height: 40px;
      background: var(--bg-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px var(--shadow-color);
      z-index: 101;
      transition: all 0.3s;
      border: none;
      outline: none;
    }
    
    .toggle-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px var(--shadow-color);
    }
    
    .toggle-btn i {
      color: var(--primary-color);
      transition: transform 0.3s;
      font-size: 1.2rem;
    }
    
    .sidebar:not(.closed) ~ .toggle-btn {
      left: 300px;
    }
    
    .sidebar:not(.closed) ~ .toggle-btn i {
      transform: rotate(180deg);
    }
    
    /* Main Content - معدل ليتناسب مع الهوم */
    .main {
      margin-left: 300px;
      padding: 30px 40px;
      transition: all 0.3s ease;
      max-width: calc(100% - 320px);
    }
    
    .sidebar.closed ~ .main {
      margin-left: 0;
      max-width: 100%;
      padding: 30px 20px;
    }
    
    /* Card Styles - مع أنيميشن قوي */
    .card {
      background: var(--bg-light);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px var(--shadow-color);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.6s ease-out forwards;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card:nth-child(1) { animation-delay: 0.1s; }
    .card:nth-child(2) { animation-delay: 0.3s; }
    .card:nth-child(3) { animation-delay: 0.5s; }
    
    .card:hover {
      transform: translateY(-10px) scale(1.01);
      box-shadow: 0 15px 35px rgba(75, 171, 177, 0.2);
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: var(--primary-color);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.6s ease;
    }
    
    .card:hover::before {
      transform: scaleX(1);
    }
    
    .card h2, .card h3 {
      color: var(--text-primary);
      margin-bottom: 20px;
      position: relative;
      display: inline-block;
    }
    
    .card h2::after, .card h3::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 50px;
      height: 3px;
      background: var(--primary-color);
      transition: width 0.4s ease;
    }
    
    .card:hover h2::after, .card:hover h3::after {
      width: 100px;
    }
    
    /* Table Styles */
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: 0 2px 10px var(--shadow-color);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-light);
    }
    
    th {
      background-color: var(--primary-color);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 500;
    }
    
    td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      transition: all 0.3s ease;
    }
    
    tr:hover td {
      background-color: rgba(75, 171, 177, 0.05);
      color: var(--text-primary);
    }
    
    .present {
      color: var(--success-color);
      font-weight: 500;
    }
    
    .absent {
      color: var(--danger-color);
      font-weight: 500;
    }
    
    /* Profile Section */
    .profile-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .profile-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid var(--primary-color);
      box-shadow: 0 5px 15px rgba(75, 171, 177, 0.3);
      transition: all 0.4s ease;
    }
    
    .profile-img:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(75, 171, 177, 0.4);
    }
    
    .profile-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 30px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(75, 171, 177, 0.3);
      margin-top: 20px;
    }
    
    .profile-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(75, 171, 177, 0.4);
    }
    
    /* Responsive Design - معدل ليتناسب مع الهوم */
    @media (max-width: 1200px) {
      .main {
        margin-left: 280px;
        max-width: calc(100% - 300px);
      }
    }
    
    @media (max-width: 992px) {
      .sidebar {
        left: 10px;
        width: 260px;
      }
      
      .main {
        padding: 25px 30px;
      }
    }
    
    @media (max-width: 768px) {
      .sidebar {
        width: 240px;
        height: 97vh;
        top: 1.5vh;
      }
      
      .main {
        margin-left: 0 !important;
        max-width: 100% !important;
        padding: 20px 15px;
      }
      
      .toggle-btn {
        left: 15px !important;
        top: 20px;
      }
      
      .card {
        padding: 20px;
      }
    }
    
    @media (max-width: 576px) {
      .card {
        padding: 15px;
      }
      
      th, td {
        padding: 10px;
      }
    }
    .present { color: green; font-weight: bold; }
  .absent { color: red; font-weight: bold; }
  .late { color: orange; font-weight: bold; }
  .excused { color: blue; font-weight: bold; }

   .logout-btn {
  margin-top: auto; /* Pushes it to the bottom */
  color: #4BABB1 !important; /* Red color for logout */
}

.logout-btn:hover {
  color: #4BABB1 !important;
  background: rgba(75, 171, 177, 0.08);
}

.logout-btn i {
  color: #4BABB1 !important;
}

.logout-btn:hover i {
  color: #4BABB1 !important;
}
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="project-name">
        <i class="fas fa-chalkboard-teacher"></i>
        <span>Teacher Portal</span>
      </div>
    </div>

    <div class="menu-items">
      <a href="HomeTeacher.html" class="menu-item active">
        <i class="fas fa-home"></i> <span>Home</span>
      </a>
      <a href="ProfileTeacher.html" class="menu-item">
        <i class="fas fa-calendar-alt"></i> <span>Profile</span>
      </a>
      <a href="AttendanceTeacher.html" class="menu-item">
        <i class="fas fa-clipboard-check"></i> <span>Attendance</span>
      </a>
      <a href="ClassTeacher.html" class="menu-item">
        <i class="fas fa-graduation-cap"></i> <span>Classes</span>
      </a>
      <a href="ExamTeacher.html" class="menu-item">
        <i class="fas fa-users"></i> <span>Exam</span>
      </a>
       <a href="resultExam.html" class="menu-item">
        <i class="fas fa-users"></i> <span>result Exam</span>
      </a>
    </div>

    <a href="#" class="menu-item logout-btn" id="logout-btn">
  <i class="fas fa-sign-out-alt"></i>
  <span>Logout</span>
</a>
  </div>

  <button class="toggle-btn" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </button>

  <div class="main">
    <!-- بطاقة الترحيب مع صورة واسم المعلم -->
    <div class="card">
  <div class="profile-section">
    <img src="" alt="Teacher Profile" class="profile-img" id="profileImg" />
    <h2 id="teacherName">Loading...</h2> <!-- تغيير النص الافتراضي -->
    <p>Here you can manage your schedule, attendance, and more.</p>
    <a href="ProfileTeacher.html" class="profile-btn">View Full Profile</a>
  </div>
</div>

    <div class="card">
  <h2>📚 Class Schedule</h2>
  <table id="scheduleTable" border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%;">
    <thead>
      <tr>
        <th>Day</th>
        <th>Time</th>
        <th>Subject</th>
      </tr>
    </thead>
    <tbody>
      <!-- البيانات هتتحط هنا -->
    </tbody>
  </table>
</div>

    <!-- جدول الحضور -->
    <div class="card">
      <h3>Your Attendance Record</h3>
      <div class="table-container">
        <table id="attendanceTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Date</th>
              <th>Status</th>
              
            </tr>
          </thead>
          <tbody>
            <!-- البيانات ستحقن هنا -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Toggle sidebar function
    function toggleSidebar() {
      const sidebar = document.querySelector(".sidebar");
      const main = document.querySelector(".main");

      sidebar.classList.toggle("closed");

      if (sidebar.classList.contains("closed")) {
        main.style.marginLeft = "0";
        main.style.maxWidth = "100%";
      } else {
        main.style.marginLeft = "300px";
        main.style.maxWidth = "calc(100% - 300px)";
      }

      localStorage.setItem("sidebarClosed", sidebar.classList.contains("closed"));
    }

    // دالة للحصول على teacherId من URL فقط
    function getTeacherId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get("teacherId");
    }

 
    // تحميل جدول الحصص
   // في دالة loadTeacherData
async function loadTeacherData(teacherId) {
  try {
    const response = await fetch(`http://54.242.19.19:3000/api/teachers/${teacherId}`);
    if (!response.ok) throw new Error("Failed to fetch teacher data");
    
    const data = await response.json();
    console.log("Teacher data:", data); // لفحص البيانات المستلمة

    // تحديث الصورة والاسم
    const profileImg = document.getElementById("profileImg");
    const teacherName = document.getElementById("teacherName");

    // تعديل هنا لاستخدام الاسم الصحيح من API
    const teacher = data.data || {};
    const fullName = teacher.fullName || teacher.name || teacher.username || "Teacher";
    
    if (teacher.photo) {
      profileImg.src = teacher.photo;
    } else {
      profileImg.src = "https://via.placeholder.com/150?text=No+Photo";
    }
    
    profileImg.alt = fullName;
    teacherName.textContent = `Welcome, ${fullName}!`; // عرض الاسم الفعلي
  } catch (error) {
    console.error("❌ خطأ في تحميل بيانات المعلم:", error);
    document.getElementById("teacherName").textContent = "Welcome, Teacher!";
    alert("حدث خطأ أثناء تحميل بيانات المعلم. يرجى المحاولة لاحقًا");
  }
}

/*
     // دالة لتحليل النصوص المقسومة بـ /
  function splitAndTrim(text) {
    return text.split('/').map(item => item.trim());
  }

  // دالة عرض الجدول في HTML
  function renderSchedule(data) {
    const tbody = document.querySelector("#scheduleTable tbody");
    tbody.innerHTML = '';

    data.forEach(entry => {
      const dayFormatted = entry.day.charAt(0).toUpperCase() + entry.day.slice(1).toLowerCase();
      const subjects = splitAndTrim(entry.subject);
      const times = splitAndTrim(entry.time);
      const count = Math.min(subjects.length, times.length);

      for (let i = 0; i < count; i++) {
        const tr = document.createElement('tr');

        if (i === 0) {
          const tdDay = document.createElement('td');
          tdDay.rowSpan = count;
          tdDay.textContent = dayFormatted;
          tr.appendChild(tdDay);
        }

        const tdTime = document.createElement('td');
        tdTime.textContent = times[i];
        tr.appendChild(tdTime);

        const tdSubject = document.createElement('td');
        tdSubject.textContent = subjects[i];
        tr.appendChild(tdSubject);

        tbody.appendChild(tr);
      }
    });
  }

  // دالة لتحميل الجدول حسب classId
  function loadSchedule(classId) {
    fetch(`http://54.242.19.19:3000/api/timetables/class/${classId}`)
      .then(response => response.json())
      .then(data => {
        renderSchedule(data);
      })
      .catch(error => {
        console.error('Error loading schedule:', error);
        const tbody = document.querySelector("#scheduleTable tbody");
        tbody.innerHTML = `<tr><td colspan="3">Failed to load schedule.</td></tr>`;
      });
  }
  const token = localStorage.getItem("token")

  // ✅ دالة لتحميل بيانات الطالب ثم تحميل الجدول بناءً على classId
 function loadStudentAndScheduleFromToken() {
    fetch("http://54.242.19.19:3000/api/students/:id", {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(student => {
      const classId = student.classId;
      const studentId = student.id;
      loadSchedule(classId);
      loadExamSchedule(studentId);
    })
    .catch(err => {
      console.error("Student error:", err);
    });
  }

  // استدعاء الدالة
  loadStudentAndScheduleFromToken();
 function formatDate(dateString) {
    const date = new Date(dateString);
    return `${date.toLocaleDateString()} ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
  }
*/
 // تحميل جدول الحضور
 async function loadAttendanceData(teacherId) {
  try {
    const response = await fetch(`http://54.242.19.19:3000/api/teachers/${teacherId}`);
    if (!response.ok) throw new Error("Failed to fetch teacher data");

    const data = await response.json();
    const attendanceTable = document.querySelector("#attendanceTable tbody");
    attendanceTable.innerHTML = "";

    const attendances = data?.data?.Attendances;

    if (!attendances || attendances.length === 0) {
      attendanceTable.innerHTML =
        '<tr><td colspan="4">No attendance data available</td></tr>';
      return;
    }

    attendances.forEach((item) => {
      const status = item.status?.toLowerCase();
      let statusClass = "unknown";

      if (status === "present") statusClass = "present";
      else if (status === "absent") statusClass = "absent";
      else if (status === "late") statusClass = "late";
      else if (status === "excused") statusClass = "excused";

      const dateObj = new Date(item.date);
      const weekday = dateObj.toLocaleDateString("en-GB", { weekday: 'long' });
      const dateFormatted = dateObj.toLocaleDateString("en-GB");

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${weekday}</td>
        <td>${dateFormatted}</td>
        <td class="${statusClass}">${item.status || "-"}</td>
        
      `;
      attendanceTable.appendChild(row);
    });
  } catch (error) {
    console.error("❌ Error loading attendance data:", error);
  }
}

 // تحميل كل البيانات عند تحميل الصفحة
document.addEventListener("DOMContentLoaded", async () => {
  // ضبط حالة السايدبار من التخزين المحلي
  const savedState = localStorage.getItem("sidebarClosed");
  const sidebar = document.querySelector(".sidebar");
  const main = document.querySelector(".main");

    if (savedState === "true") {
    sidebar.classList.add("closed");
    main.style.marginLeft = "0";
    main.style.maxWidth = "100%";
  } else {
    main.style.marginLeft = "300px";
    main.style.maxWidth = "calc(100% - 300px)";
  }

  // الحصول على معرف المعلم من localStorage بدلاً من URL
  const teacherId = localStorage.getItem("userID");
  const role = localStorage.getItem("role");

  // التحقق من أن المستخدم معلم
  if (!teacherId || role !== "teacher") {
    alert("❌ يجب تسجيل الدخول كمعلم أولاً");
    window.location.href = "/index.html";
    return;
  }

  await loadTeacherData(teacherId);
 // await loadScheduleData(teacherId);
 await loadAttendanceData(teacherId);
});

 // Logout functionality
document.getElementById('logout-btn').addEventListener('click', function(e) {
  e.preventDefault();
  
  // Add your logout logic here
  // For example, redirect to home page:
  window.location.href = '../index.html'; // Change to your home page URL
  
  // If you need to clear session/local storage:
  // localStorage.clear();
  // sessionStorage.clear();
});
  </script>
</body>
</html>